<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrada de Tarefas</title>
    <link rel="stylesheet" href="../../assets/css/InsereTarefas.css">
</head>
<body>



    <img src="../../assets/images/Imagem preguiça 2.png" alt="" class="Preguica">
    
    
    <div id="Centro">

        <div class="topo">
            <button id="btnCancelar">Limpar</button>
        </div>
        <h2 class="Ndp2">Nos diga o que você precisa fazer</h2>
        <div class="topo2">
            <a id="btnVoltar" href="index.html">Voltar</a>
        </div>

        <div class="EntradaTudo">
            <form action="InsereTarefas.html" id="AddTarefas">

                <label for="EntradaInfo" class="InserirParagrafo">Entrada de Tarefa</label>
                <input type="text" id="Entrada" placeholder="Insira sua tarefa">
                <br>
                <label for="EntradaData" class="DataParagrafo">Entrada de Data</label>
                <input type="date" id="EntradaData"/>
                <br>
                <div class="inputs-importancia">
                     <div class="Importancia-Input">
                        <input type="radio" id="imp-baixa" name="importancia" value="Baixa">
                        <label for="imp-baixa">Baixa Importância</label>
                    </div>
                    <div class="Importancia-Input">
                        <input type="radio" id="imp-media" name="importancia" value="Media">
                        <label for="imp-media">Média Importância</label>
                    </div>
                    <div class="Importancia-Input">
                        <input type="radio" id="imp-alta" name="importancia" value="Alta">
                        <label for="imp-alta">Alta Importância</label>
                    </div>
                </div>

                <div class="Add">
                <input type="submit" value="Adicionar" class="Adicionar">
                </div>
            </form>
        </div>

            <div class="carrossel-wrapper">
                <button id="anterior">‹</button>
                <div class="carrossel" id="criaCard"></div>
                <button id="proximo">›</button>
            </div>
          

    </div>



    

    <script>

        //COLETA DE DADOS INSERIDOS

        let nivelImportanciaSelecionado = null;

        document.addEventListener('DOMContentLoaded', () => {

            window.onload = exibirTarefas;
            const inputsContainer = document.querySelector('.inputs-importancia');

            inputsContainer.addEventListener('change', (event) => {

                if (event.target.tagName === 'INPUT' && event.target.type === 'radio' && event.target.checked) {

                    nivelImportancia = event.target.value;


                }



            })


        })
        
        document.getElementById('AddTarefas').addEventListener('submit', (event) => {
            event.preventDefault();

            const Tarefa = document.getElementById('Entrada').value
            const Data = document.getElementById('EntradaData').value

            if (!Tarefa || !Data || !nivelImportancia) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            const novaTarefaItem = {
                "TarefasListada": Tarefa,
                "Importancia": nivelImportancia
            };

            let dadosSalvos = localStorage.getItem('calendarioDeTarefas');
            let calendarioTarefas;

            if (dadosSalvos) {
                    calendarioTarefas = JSON.parse(dadosSalvos);
                } else {
                    calendarioTarefas = { "tarefas": [] };
                }

                let diaExist = calendarioTarefas.tarefas.find(d => d.DataListada === Data);

                if (diaExist) {
                    diaExist.itens.push(novaTarefaItem);
                } else {
                    calendarioTarefas.tarefas.push({
                        "DataListada": Data,
                        "itens": [novaTarefaItem]
                    });
                }

                localStorage.setItem('calendarioDeTarefas', JSON.stringify(calendarioTarefas));
                exibirTarefas();

            alert(Tarefa +' '+ Data +' '+ nivelImportancia);


        })
        //FIM COLETA DE DADOS INSERIDOS



        //CRIA CARDS

        function exibirTarefas() {
            const container = document.getElementById('criaCard');
            container.innerHTML = ''; 

            let dadosSalvos = localStorage.getItem('calendarioDeTarefas');
            if (!dadosSalvos) return;

            let calendarioDeTarefas = JSON.parse(dadosSalvos);

            for (let i = 0; i < calendarioDeTarefas.tarefas.length; i++) {
                let dia = calendarioDeTarefas.tarefas[i];
                let itens = dia.itens;
            
                for (let j = 0; j < itens.length; j++) {
                    let tarefa = itens[j];
                
                    const card = document.createElement('div');
                    card.classList.add('card-tarefa'); 
                
                    card.innerHTML = `
                        <div class="CardCarrosel">
                            <h3>${tarefa.TarefasListada}</h3>
                            <p>Data: ${dia.DataListada}</p>
                            <p>Importância: ${tarefa.Importancia}</p>
                            <button class="btn-deletar" data-dia="${dia.DataListada}" data-index="${j}">Deletar</button>
                        </div>
                            `;
                
                    container.appendChild(card);
                }
            }

            document.getElementById('anterior').addEventListener('click', () => {
            document.getElementById('criaCard').scrollBy({ left: -270, behavior: 'smooth' });
            });

            document.getElementById('proximo').addEventListener('click', () => {
            document.getElementById('criaCard').scrollBy({ left: 270, behavior: 'smooth' });
            });

            const botoesDeletar = document.querySelectorAll('.btn-deletar');
            for (let i = 0; i < botoesDeletar.length; i++) {
                botoesDeletar[i].addEventListener('click', function () {
                    const data = this.getAttribute('data-dia');
                    const index = parseInt(this.getAttribute('data-index'));
                
                    let dados = localStorage.getItem('calendarioDeTarefas');
                    let calendario = JSON.parse(dados);
                
                    let dia = calendario.tarefas.find(d => d.DataListada === data);
                    if (dia) {
                        dia.itens.splice(index, 1);
                        if (dia.itens.length === 0) {
                            calendario.tarefas = calendario.tarefas.filter(d => d.DataListada !== data);
                        }
                    }
                
                    localStorage.setItem('calendarioDeTarefas', JSON.stringify(calendario));
                    exibirTarefas();
                });
            }
        }




        // DELETAR CARD
        for (let i = 0; i < botoesDeletar.length; i++) {
            botoesDeletar[i].addEventListener('click', function () {
                const data = this.getAttribute('data-dia');
                const index = parseInt(this.getAttribute('data-index'));
            
                let dadosSalvos = localStorage.getItem('calendarioDeTarefas');
                let calendario = JSON.parse(dadosSalvos);
            
                let dia = calendario.tarefas.find(d => d.DataListada === data);
                if (dia) {
                    dia.itens.splice(index, 1); 
                    if (dia.itens.length === 0) {
                        calendario.tarefas = calendario.tarefas.filter(d => d.DataListada !== data);
                    }
                }
            
                localStorage.setItem('calendarioDeTarefas', JSON.stringify(calendario));
                exibirTarefas();
            });
        }
        //FIM DELETAR CARD
        //FIM CRIA CARDS



        //BOTÃO PARA LIMPAR ENTRADA DE DADOS
        document.getElementById('btnCancelar').addEventListener('click', function () {

            document.getElementById('AddTarefas').reset();
            nivelImportancia = null;
            document.querySelectorAll('.inputs-importancia input[type="radio"]').forEach(radio => radio.checked = false);
            
        });
        //FIM BOTÃO PARA LIPAR ENTRADA DE DADOS



    </script>







</body>
</html>