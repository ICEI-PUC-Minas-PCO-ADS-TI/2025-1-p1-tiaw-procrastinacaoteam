<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrada de Tarefas</title>
    <link rel="stylesheet" href="../../assets/css/InsereTarefas.css">
    <link rel="icon" href="../../assets/images/Imagem preguiça 2.png">

</head>
<body>

    <h1 class="ACTION-MODE">ACTION MODE</h1>

    <img src="../../assets/images/logo preguiça maior(1).png" alt="" class="Preguica">
    
    
    <div id="Centro">

        <div class="topo">
            <button id="btnCancelar">Limpar</button>
        </div>
        <h2 class="Ndp2">Nos diga o que você precisa fazer</h2>
        <div class="topo2">
            <a id="btnVoltar" href="Pagina.html">Voltar</a>
        </div>

        <div class="EntradaTudo">
            <form action="InsereTarefas.html" id="AddTarefas">

                <label for="EntradaInfo" class="InserirParagrafo">Entrada de Tarefa</label>
                <input type="text" id="Entrada" placeholder="Insira sua tarefa">
                <br>
                <label for="EntradaData" class="DataParagrafo">Entrada de Data</label>
                <input type="date" id="EntradaData"/>
                <br>
                <div class="inputs-importancia">
                     <div class="Importancia-Input">
                        <input type="radio" id="imp-baixa" name="importancia" value="Baixa">
                        <label for="imp-baixa">Baixa Importância</label>
                    </div>
                    <div class="Importancia-Input">
                        <input type="radio" id="imp-media" name="importancia" value="Media">
                        <label for="imp-media">Média Importância</label>
                    </div>
                    <div class="Importancia-Input">
                        <input type="radio" id="imp-alta" name="importancia" value="Alta">
                        <label for="imp-alta">Alta Importância</label>
                    </div>
                </div>

                <div class="Add">
                <input type="submit" value="Adicionar" class="Adicionar">
                </div>
            </form>
        </div>

            <div class="carrossel-wrapper">
                <button id="anterior">‹</button>
                <div class="carrossel" id="criaCard"></div>
                <button id="proximo">›</button>
            </div>
          

    </div>



    

    <script>

        //COLETA DE DADOS INSERIDOS

        let nivelImportanciaSelecionado = null;

        document.addEventListener('DOMContentLoaded', () => {
            const inputsContainer = document.querySelector('.inputs-importancia');

            inputsContainer.addEventListener('change', (event) => {

                if (event.target.tagName === 'INPUT' && event.target.type === 'radio' && event.target.checked) {

                    nivelImportancia = event.target.value;
                }
            })


        })


        document.getElementById('AddTarefas').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData(this);
        //  const dados = Object.fromEntries(formData.entries());
        const dados = {
            DataListada: document.getElementById("EntradaData").value,
            itens:[{
                TarefasListada: document.getElementById("Entrada").value,
                nivelImportancia: nivelImportancia
            }],

        };

         fetch('http://localhost:3000/dados', {
           method: 'POST',
           headers: {
             'Content-Type': 'application/json'
           },
           body: JSON.stringify(dados)
         })
         .then(response => response.json())
         .then(data => {
           console.log('Jogo cadastrado com sucesso:', data);
         })
        });

        document.getElementById('btnLimpar').addEventListener('click', function(){

            document.getElementById('AddTarefas').reset();
        });

        //FIM COLETA DE DADOS INSERIDOS



        //CRIA CARDS

        function exibirTarefas() {
            fetch("http://localhost:3000/dados")
            .then(res => res.json())
            .then(dadosDoServidor => {
                dadosDoServidor.sort((a, b) => new Date(a.DataListada) - new Date(b.DataListada));

                dadosDoServidor.forEach(dia => { 
                    let itens = dia.itens;


                
                    itens.forEach((tarefa, indexTarefa) => {
                        const card = document.createElement('div');
                        card.classList.add('card-tarefa'); 
                    
                        if (tarefa.nivelImportancia == 'Alta') {
                            card.classList.add('imp-alta');
                        } else if (tarefa.nivelImportancia == 'Media') {
                            card.classList.add('imp-media');
                        } else if (tarefa.nivelImportancia == 'Baixa') {
                            card.classList.add('imp-baixa');
                        }
                    
                        card.innerHTML = `
                            <div class="CardCarrossel">
                                <h3>${tarefa.TarefasListada}</h3>
                                <p>Data: ${dataFormatada}</p>
                                <p>Importância: ${tarefa.nivelImportancia}</p> 
                                <button class="btn-deletar" data-id-data="${dia.id}" data-index-tarefa="${indexTarefa}">Deletar</button>
                            </div>
                        `;
                        
                        container.appendChild(card);
                    });
                });
                

                document.getElementById('anterior').addEventListener('click', () => {
                document.getElementById('criaCard').scrollBy({ left: -270, behavior: 'smooth' });
                });

                document.getElementById('proximo').addEventListener('click', () => {
                document.getElementById('criaCard').scrollBy({ left: 270, behavior: 'smooth' });
                });
                const botoesDeletar = document.querySelectorAll('.btn-deletar');
                for (let i = 0; i < botoesDeletar.length; i++) {
                    botoesDeletar[i].addEventListener('click', function () {
                        const data = this.getAttribute('data-dia');
                        const index = parseInt(this.getAttribute('data-index'));
                    
                        let dados = localStorage.getItem('calendarioDeTarefas');
                        let calendario = JSON.parse(dados);
                    
                        let dia = calendario.tarefas.find(d => d.DataListada === data);
                        if (dia) {
                            dia.itens.splice(index, 1);
                            if (dia.itens.length === 0) {
                                calendario.tarefas = calendario.tarefas.filter(d => d.DataListada !== data);
                            }
                        }
                    
                        localStorage.setItem('calendarioDeTarefas', JSON.stringify(calendario));
                    });
                }

                for (let i = 0; i < botoesDeletar.length; i++) {
                botoesDeletar[i].addEventListener('click', function () {
                const data = this.getAttribute('data-dia');
                const index = parseInt(this.getAttribute('data-index'));
            
                let dadosSalvos = localStorage.getItem('calendarioDeTarefas');
                let calendario = JSON.parse(dadosSalvos);
            
                let dia = calendario.tarefas.find(d => d.DataListada === data);
                if (dia) {
                    dia.itens.splice(index, 1); 
                    if (dia.itens.length === 0) {
                        calendario.tarefas = calendario.tarefas.filter(d => d.DataListada !== data);
                    }
                }
            
                localStorage.setItem('calendarioDeTarefas', JSON.stringify(calendario));
            });
        }
            })
        }




        // DELETAR CARD

        //FIM DELETAR CARD
        //FIM CRIA CARDS



        //BOTÃO PARA LIMPAR ENTRADA DE DADOS
        document.getElementById('btnCancelar').addEventListener('click', function () {

            document.getElementById('AddTarefas').reset();
            nivelImportancia = null;
            document.querySelectorAll('.inputs-importancia input[type="radio"]').forEach(radio => radio.checked = false);
            
        });
        //FIM BOTÃO PARA LIPAR ENTRADA DE DADOS



    </script>







</body>
</html>